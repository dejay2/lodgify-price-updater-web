<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Lodgify Price Updater (Web)</title>
    <link rel="stylesheet" href="/styles.css" />
  </head>
  <body>
    <main>
      <h1>Lodgify Price Updater</h1>
      <nav class="tabs">
        <button data-page="properties" class="tab active">Properties</button>
        <button data-page="seasons" class="tab">Seasons</button>
        <button data-page="calendar" class="tab">Calendar</button>
        <button data-page="run" class="tab">Run</button>
      </nav>
      <section class="card page" data-page="run">
        <h2>Settings</h2>
        <div class="grid">
          <label>API Key<input id="apiKey" type="password" placeholder="Leave blank to use .env" /></label>
          <label>Start Date<input id="startDate" type="date" disabled title="Auto: today" /></label>
          <label>End Date<input id="endDate" type="date" disabled title="Auto: 18 months from today" /></label>
          <label>Window Days<input id="windowDays" type="number" value="30" min="0" max="365" /></label>
          <label>Start Discount %<input id="startDiscountPct" type="number" value="30" step="0.5" /></label>
          <label>End Discount %<input id="endDiscountPct" type="number" value="1" step="0.5" /></label>
          <label>Minimum Price<input id="minPrice" type="number" value="0" step="1" /></label>
          <label>Rules File<input id="rulesFile" type="text" value="price_rules.json" /></label>
          <label class="checkbox"><input id="dryRun" type="checkbox" checked /> Dry Run</label>
        </div>
        <div class="actions">
          <button id="loadProps">Load Properties</button>
        </div>
      </section>

      <section class="card page" data-page="run">
        <h2>Properties</h2>
        <div id="props"></div>
      </section>

      <section class="card page" data-page="properties">
        <h2>Properties</h2>
        <div class="grid grid-4">
          <label>Rules File<input id="rulesFile2" type="text" value="price_rules.json" /></label>
          <label>Property<select id="propSelectRules"></select></label>
          <label>Base Rate (£)<input id="baseRate" type="number" step="1" /></label>
          <label>Min Rate (£)<input id="minRate" type="number" step="1" /></label>
          <label>Weekend Rate %<input id="weekendRate" type="number" step="0.5" value="0" /></label>
          <label>Additional Guest £<input id="ppag" type="number" step="1" value="0" /></label>
          <label>Additional Starts From<input id="addlFrom" type="number" step="1" value="0" /></label>
        </div>
        <div class="actions">
          <button id="loadRules">Load Rules</button>
          <button id="saveRates">Save</button>
        </div>
        <h3>Length-of-Stay Rates</h3>
        <div id="los"></div>
        <div class="actions">
          <button id="addLos">Add LOS Rule</button>
          <button id="saveLos">Save LOS</button>
        </div>
      </section>

      <section class="card page" data-page="seasons">
        <h2>Seasonal Rules</h2>
        <div class="grid grid-4">
          <label>Rules File<input id="rulesFile3" type="text" value="price_rules.json" /></label>
        </div>
        <div class="actions">
          <button id="loadRules">Load Rules</button>
        </div>
        <h3>Seasons</h3>
        <div id="seasons"></div>
        <div class="actions">
          <button id="addSeason">Add Season</button>
          <button id="saveSeasons">Save Seasons</button>
        </div>
      </section>

      <section class="card page" data-page="calendar">
        <h2>Calendar</h2>
        <div class="grid grid-4">
          <label>Property<select id="propSelectCal"></select></label>
          <label>Month<input id="monthInput" type="month" /></label>
          <div class="actions">
            <button id="prevMonth">◀ Prev</button>
            <button id="nextMonth">Next ▶</button>
          </div>
          <label>Override Color<input id="overrideColor" type="color" value="#ffd1dc" /></label>
        </div>
        <div id="seasonLegend" class="legend"></div>
        <div id="calendar" class="calendar"></div>
      </section>
      <div id="overrideModal" class="modal" aria-hidden="true">
        <div class="panel">
          <h3>Day Override</h3>
          <div><strong id="ovrDateDisplay"></strong> — <span id="ovrPropName"></span></div>
          <div class="grid">
            <label>Price (£)<input id="ovrPrice" type="number" step="1" /></label>
            <label>Min Stay<input id="ovrMin" type="number" step="1" min="1" /></label>
            <label>Max Stay<input id="ovrMax" type="number" step="1" min="1" /></label>
          </div>
          <div class="actions">
            <button id="ovrSave">Save</button>
            <button id="ovrDelete">Remove</button>
            <button id="ovrCancel">Cancel</button>
          </div>
        </div>
      </div>

      <section class="card page" data-page="run">
        <h2>Run</h2>
        <div class="actions">
          <button id="runBtn">Run Update</button>
        </div>
        <pre id="log" class="log"></pre>
      </section>
  </main>
  <div id="toast-container" class="toast-container" aria-live="polite" aria-atomic="true"></div>
  <script src="/app.js" type="module"></script>
 </body>
 </html>
