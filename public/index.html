<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Lodgify Price Updater (Web)</title>
    <link rel="stylesheet" href="/styles.css" />
  </head>
  <body>
    <main>
      <h1>Lodgify Price Updater</h1>
      <nav class="tabs">
        <button data-page="calendar" class="tab active">Calendar</button>
        <button data-page="settings" class="tab">Settings</button>
        <button data-page="discounts" class="tab">Discounts</button>
        <button data-page="properties" class="tab">Properties</button>
        <button data-page="los" class="tab">LOS</button>
        <button data-page="seasons" class="tab">Seasons</button>
        <button data-page="run" class="tab">Run</button>
      </nav>
      <section class="card page" data-page="settings">
        <h2>Settings</h2>
        <div class="grid grid-4">
          <label
            >API Key<input id="apiKey" type="password" placeholder="Leave blank to use .env"
          /></label>
          <label>Rules File<input id="rulesFile" type="text" value="price_rules.json" /></label>
          <label>Override Color<input id="overrideColor" type="color" value="#ffd1dc" /></label>
          <div class="actions" style="align-self: end">
            <button id="saveSettings">Save Settings</button>
            <button id="loadProps">Reload Properties</button>
          </div>
        </div>
        <h3>Channel Fees / Uplifts</h3>
        <div class="grid grid-4">
          <label
            >Airbnb Uplift %<input id="airbnbUpliftPct" type="number" step="0.5" value="0"
          /></label>
          <label>Airbnb Addon £<input id="airbnbAddon" type="number" step="1" value="0" /></label>
          <label
            >Booking.com Uplift %<input id="bookingUpliftPct" type="number" step="0.5" value="0"
          /></label>
          <label
            >Booking.com Addon £<input id="bookingAddon" type="number" step="1" value="0"
          /></label>
          <label
            >OH/Website Addon £<input id="ohAddon" type="number" step="1" value="0"
          /></label>
        </div>
        <h3>Fee Fold‑In</h3>
        <div class="grid grid-4">
          <label><input id="foldFeesEnabled" type="checkbox" /> Fold cleaning + service into nightly</label>
          <label><input id="foldIncludeCleaning" type="checkbox" checked /> Include Cleaning Fee</label>
          <label><input id="foldIncludeService" type="checkbox" checked /> Include Service Fee</label>
        </div>
        <h3>Jitter (Auto Price Tweaks)</h3>
        <div class="grid grid-4">
          <label><input id="jitterEnabled" type="checkbox" /> Enable Auto Jitter</label>
          <label
            >Interval (min)<input id="jitterInterval" type="number" step="1" min="5" value="60"
          /></label>
          <label
            >Lookahead (days)<input id="jitterLookahead" type="number" step="1" min="1" value="30"
          /></label>
          <label
            >Block Near (days)<input id="jitterBlockNear" type="number" step="1" min="0" value="2"
          /></label>
        </div>
        <div class="grid grid-4">
          <label
            >Dates per run<input id="jitterDatesPerRun" type="number" step="1" min="1" value="2"
          /></label>
          <label
            >Markdown min %<input id="jitterMarkdownMin" type="number" step="0.5" value="5"
          /></label>
          <label
            >Markdown max %<input id="jitterMarkdownMax" type="number" step="0.5" value="8"
          /></label>
          <label
            >Markup min %<input id="jitterMarkupMin" type="number" step="0.5" value="0"
          /></label>
        </div>
        <div class="grid grid-4">
          <label
            >Markup max %<input id="jitterMarkupMax" type="number" step="0.5" value="2"
          /></label>
          <label>Random Seed<input id="jitterSeed" type="text" placeholder="optional" /></label>
        </div>
      </section>

      <section class="card page" data-page="discounts">
        <h2>Discounts</h2>
        <div class="grid grid-4">
          <label
            >Window Days<input id="windowDays" type="number" value="30" min="0" max="365"
          /></label>
          <label
            >Start Discount %<input id="startDiscountPct" type="number" value="30" step="0.5"
          /></label>
          <label
            >End Discount %<input id="endDiscountPct" type="number" value="1" step="0.5"
          /></label>
          <label>Minimum Price<input id="minPrice" type="number" value="0" step="1" /></label>
        </div>
        <div class="actions">
          <button id="saveDiscounts">Save Discounts</button>
        </div>
      </section>

      <section class="card page" data-page="run">
        <h2>Properties</h2>
        <div id="props"></div>
      </section>

      <section class="card page" data-page="properties">
        <h2>Properties</h2>
        <div class="grid grid-4">
          <label>Property<select id="propSelectRules"></select></label>
          <label>Base Rate (£)<input id="baseRate" type="number" step="1" /></label>
          <label>Min Rate (£)<input id="minRate" type="number" step="1" /></label>
          <label>Min Profit %<input id="minProfitPct" type="number" step="0.5" value="0" /></label>
          <label>Weekend Rate %<input id="weekendRate" type="number" step="0.5" value="0" /></label>
          <label
            >Max Discount %<input
              id="maxDiscountPct"
              type="number"
              step="0.5"
              value=""
              placeholder="(optional)"
          /></label>
          <label>Additional Guest £<input id="ppag" type="number" step="1" value="0" /></label>
          <label
            >Additional Starts From<input id="addlFrom" type="number" step="1" value="0"
          /></label>
          <label>Cleaning Fee £<input id="cleaningFee" type="number" step="1" value="0" /></label>
          <label>Service Fee £<input id="serviceFee" type="number" step="1" value="0" /></label>
        </div>
        <div class="actions">
          <button id="saveRates">Save</button>
        </div>
      </section>

      <section class="card page" data-page="los">
        <h2>Length-of-Stay Rates (Global)</h2>
        <div id="losGlobal"></div>
        <div class="actions">
          <button id="addLosGlobal">Add LOS Rule</button>
          <button id="saveLosGlobal">Save LOS</button>
        </div>
      </section>

      <section class="card page" data-page="seasons">
        <h2>Seasonal Rules</h2>
        <div class="actions"></div>
        <h3>Seasons</h3>
        <div id="seasons"></div>
        <div class="actions">
          <button id="addSeason">Add Season</button>
          <button id="saveSeasons">Save Seasons</button>
        </div>
      </section>

      <section class="card page" data-page="calendar">
        <h2>Calendar</h2>
        <div class="grid grid-4">
          <label>Property<select id="propSelectCal"></select></label>
          <label>Month<input id="monthInput" type="month" /></label>
          <div class="actions">
            <button id="prevMonth">◀ Prev</button>
            <button id="nextMonth">Next ▶</button>
          </div>
        </div>
        <div id="seasonLegend" class="legend"></div>
        <div id="calendar" class="calendar"></div>
      </section>
      <div id="overrideModal" class="modal" aria-hidden="true">
        <div class="panel">
          <h3>Day Override</h3>
          <div><strong id="ovrDateDisplay"></strong> — <span id="ovrPropName"></span></div>
          <div class="grid">
            <label>Price (£)<input id="ovrPrice" type="number" step="1" /></label>
            <label>Min Stay<input id="ovrMin" type="number" step="1" min="1" /></label>
            <label>Max Stay<input id="ovrMax" type="number" step="1" min="1" /></label>
          </div>
          <div class="actions">
            <button id="ovrSave">Save</button>
            <button id="ovrDelete">Remove</button>
            <button id="ovrCancel">Cancel</button>
          </div>
        </div>
      </div>

      <section class="card page" data-page="run">
        <h2>Run</h2>
        <div class="actions">
          <button id="dryRunBtn">Dry Run</button>
          <button id="runBtn">Run Update</button>
          <button id="importBookings">Import Upcoming Bookings</button>
          <button id="importAllBookings">Import All Bookings</button>
          <button id="syncUpdates">Sync Updates (since last run)</button>
        </div>
        <div class="grid">
          <label
            >Last Sync<input id="lastSyncAt" type="text" disabled placeholder="not yet synced"
          /></label>
        </div>
        <pre id="log" class="log"></pre>
      </section>
    </main>
    <div id="toast-container" class="toast-container" aria-live="polite" aria-atomic="true"></div>
    <script src="/app.js" type="module"></script>
  </body>
</html>
